
# Flutter Project

## 概要
このプロジェクトは、Flutterを使用して開発されたクロスプラットフォームアプリケーションです。WebおよびiOSで動作するよう設計されています。

主な機能:
* ドレミとあそぼ：クエリパラメータ(?env=○○)で各音を選択します。(Do,Re,…,Do2)
	* タイトル：画面のどこかをクリックでBGMが鳴り、7秒(BGMの再生時間)経過で次のBGMが再生開始し、「おぼえましょう」画面にいきます。
	* おぼえましょう：11秒(BGMの再生時間)経過で「貼りましょう」画面にいきます。
	* 貼りましょう：ページは2種類あります。正しい〇の上にシールをドラッグ＆ドロップで正解音、違う場所へのドロップで不正解音が鳴ります。
		全てのシールを正解でファンファーレが鳴り次へボタンが出現し、2回目の貼りましょう画面で次へを押すとかきましょう画面にいきます。
	* かきましょう：ドラッグで線をかきます。表示された全ての〇の中に線が入っていればファンファーレが鳴り次へボタンが出現します。
		次へボタンを押すとタイトル画面に戻ります。

* おんぷゲーム①：スタートボタンを押すと楽譜がランダムに切り変わります(フラッシュカード)。
	スタートボタンは2種類あり、それぞれフラッシュカードの再生速度が違います。
	全7問で、表示される楽譜を見て、問題と同じ音の時にキャラアイコンボタンを押すと正解音が鳴ります。違う音の時にボタンを押すと不正解音が鳴ります。
	ランダムな順番で問題の音が変わり、7種類の問題が終わった後に終了画面が表示されます。
	終了画面は2種類あり、どの速度でスタートしたかによって分岐します。

* おんぷゲーム②：楽譜を見て正しい音のボタンを押します。アイコン版と鍵盤版の2種類あります。最後の問題で次へボタンを押すと終了画面が表示されます。
	* アイコン版：スタートボタン押下で始まります。楽譜を見て正しい音のキャラアイコンボタンを押します。
		正しければ正解音が鳴り、楽譜が切り変わります。間違った場合は不正解音が鳴ります。楽譜の順番はランダムです。
	* 鍵盤版：スタートボタン押下で始まります。楽譜を見て正しい音の鍵盤を押します。
		正しければ正解音が鳴り、楽譜が切り変わります。間違った場合は不正解音が鳴ります。楽譜の順番はランダムです。

* 線と間A：線の上版と線の間版の2種類あります。画像をドラッグ＆ドロップで楽譜上に配置します。
	正しい場所に配置で正解音、違う場所に配置で不正解音が鳴ります。全て正しい場所に配置でファンファーレが鳴り、次へボタンが出現します。
	次へボタン押下で次の問題に進みます。最後の問題で次へボタンを押すと終了画面が表示されます。

* 線と間B：線の上版と線の間版の2種類あります。
	楽譜に画像が配置されており、正しい位置にある画像を押すと正解音、違う位置にある画像を押すと不正解音が鳴ります。
	正しい位置にある全ての画像を押すとファンファーレが鳴ります。次へボタン押下で次の問題に進みます。最後の問題で次へボタンを押すと終了画面が表示されます。

* 線と間C：線の上版と線の間版の2種類あります。スタートボタン押下で始まります。
	楽譜を見て何番目の線の上(間)にあるかを1~5のボタンで選択します。正しいボタンを押すと正解音が鳴り、楽譜が切り替わります。間違ったボタンを押すと不正解音が鳴ります。
	楽譜の順番はランダムです。問題終了で次へボタンが出現し、押下で終了画面が表示されます。

* パズル：ト音/ヘ音、音符/休符に分かれており、処理が2種類あります。
	* ト音/ヘ音：4分割されたピースがあり、スタートボタンを押すとバラバラに配置されます。
		ドラッグ＆ドロップで全てのピースを正しい場所に配置するとファンファーレが鳴り次へボタンが出現します。次へボタン押下で終了画面が表示されます。
	* 音符/休符：開始画面でスタートボタンを押すと、各音符(休符)の見本が表示されます。もう一度スタートボタン押下で3秒(開始音の再生時間)経過後に5(7)種類のピースがバラバラに配置されます。
		問題に必要なピースを水色の枠内に見本と同じ形になるようにドラッグ＆ドロップで配置し、不要なピースを全て枠外に出すとファンファーレが鳴り、次へボタンが出現します。
		次へボタンを押下で次の問題が始まります。音符パズルは全音符/2分音符/4分音符/8分音符/付点2分音符/付点4分音符の6種類、休符パズルは全休符/8分休符/付点4分休符の3種類です。
		最後の問題で次へボタンを押すと終了画面が表示されます。

* 楽器あてクイズ：スタートボタン押下で音楽が流れます。流れた音を聞いて3つの楽器ボタンから正解を見つけて押します。正解なら正解音、間違いなら不正解音が鳴り、次へボタンが出現します。
	次へボタンを押下すると音楽が流れ、次の問題が始まります。どの楽器の音が流れるかはランダムです。最後の問題で次へボタンを押すと終了画面が表示されます。

「ドレミとあそぼ」はWeb版のみ、それ以外はWeb版とiOS版の想定です。


---

## 環境構築

### 前提条件
以下の環境が必要です:
- fvm(Flutterのバージョン管理用)
- VisualStudioCode(開発用)
- Xcode（iOS開発用）

### 使用技術
- Flutter: 3.24.4
- Dart: 3.5.4

---

## インストールと実行

### リポジトリのクローン
```bash
git clone <リポジトリURL>
cd <プロジェクト名>
```

### 依存関係のインストール
```bash
flutter pub get
```

### Flutterのインストール
```bash
fvm install <Flutterバージョン>
fvm use <Flutterバージョン>
```

### デバッグ実行の手順
1. リポジトリのフォルダをVSCodeで開く
2. 「実行とデバッグ(Ctrl+Shift+D)」の上部タブで、実行したいアプリ(○○_app)を選択
3. デバッグの開始(F5)で実行

---

## ディレクトリ構成

```
.
├─ 〇〇/			# パッケージ
│   ├── lib/				# メインアプリケーションコード
│   │   ├── 〇〇.dart			# 依存関係
│   │   ├── setting.dart		# 設定ファイル
│   │   ├── page/				# 画面関連のコード
│   │   ├── page_state/		# 画面のステータス関連のコード
│   │   └── widget/			# 再利用可能なウィジェット
│   ├── pubspec.yaml        # 依存関係とプロジェクト設定
│   └── README.md           # プロジェクトの説明
│
├─ 〇〇_app/			# アプリケーション
│   ├── lib/				# メインアプリケーションコード
│   │   └── main.dart		# アプリのエントリーポイント
│   ├── assets/             # 静的アセット（画像やSEなど）
│   ├── pubspec.yaml        # 依存関係とプロジェクト設定
│   └── README.md           # プロジェクトの説明
│
└─ simple_http_server	# 確認用のSimpleHttpServer
```

 * doremi：「ドレミとあそぼ」のパッケージ
 * doemi_app：「ドレミとあそぼ」のアプリケーション

 * onpu：おんぷゲーム①②、線と間A～Cのパッケージ
 * onpu_app：おんぷゲーム①②、線と間A～Cのアプリケーション

 * puzzle_quiz：パズル、楽器あてクイズのパッケージ
 * puzzle_app：パズルのアプリケーション
 * quiz_app：クイズのアプリケーション


各アプリの`assets/images` には、4種類の画像サイズ別のフォルダがあり、どのフォルダ内の画像を使うかは後述のsettings.dartで行います。
現在は
```bash
2266x1488、2732x2048、2796x1290、1334x750
```
の4種類あります。
画像サイズフォルダ外に、全画面サイズ共通で同じ画像をサイズだけ変えて使っているものもあります。

---

## 設計

### page
各ページの表示を行います。

### page_state
各ページのステータス管理を行います。

### widget
異なるページでも再利用できるウィジェットや、ステータスを持つウィジェットです。

### setting.dart
主に画面サイズに合わせて4種類の画像や表示座標、サイズなどを切り替えるために使います。


---

## ビルド

### Webアプリのビルド
```bash
flutter build web
```

生成されたファイルは `build/web` に保存されます。

### iOSアプリのビルド
```bash
flutter build ios
```

Xcodeを使ってiOSアプリをアーカイブしてください。

---

## 使用方法(Web版)
1. ビルドします。
2. `build/web`の中身全てを`simple_http_server/public`にコピー
3. `simple_http_server/launch.bat` を管理者権限で実行
4. コンソールウィンドウが開かれた状態で http://localhost:8000 をWebブラウザで表示
